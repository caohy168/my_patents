<html><head><title>全文文本(Fulltext)</title><meta http-equiv='Content-Type' content='text/html; charset=UTF-8'><style>div.fullText table {width: 100%;text-indent: 1px;} 
 div.fullText table td.header {font-weight: bold;text-align: center;font-family: '宋体';font-size: 16px;line-height:20px;color: #000000;padding: 5px;}div.fullText table td.content {padding: 1px;text-align: left;vertical-align: top;width: 100%;font-family: '宋体';font-size: 14px;line-height:20px;color: #000000;}</style></head><body><?xml version="1.0" encoding="UTF-8"?><div xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:siposeas="java:com.neusoft.sipo.sipopublicsearch.search.app.view.detailUtils.xsltParser.XsltSeasParser" xmlns:str="http://example.com/namespace" class="fullText"><table class="fullText"><tr><td id="claim_title" class="header">权利要求书</td></tr><tr><td class="content" id="claim_1">1.一种双接口智能卡的片内操作系统，其特征在于，该系统包括：智能卡
      <br/>接口传输管理模块、高速数据接口传输管理模块、安全管理模块、应用管理模
      <br/>块、文件管理模块和高速数据协处理模块；
      <br/>
				</td></tr><tr><td class="content" id="claim_2">智能卡接口传输管理模块或高速数据接口传输管理模块，用于读取命令头，
      <br/>并将读取到的命令头发送给安全管理模块；
      <br/>
				</td></tr><tr><td class="content" id="claim_3">安全管理模块，用于对命令头进行安全机制检查，并将通过检查的命令头
      <br/>发送给应用管理模块；
      <br/>
				</td></tr><tr><td class="content" id="claim_4">应用管理模块，用于根据接收到的命令头判断业务类型，如果命令头表明
      <br/>业务类型为普通数据业务，则将命令头中指定长度的后续有效字节数据发送给
      <br/>文件管理模块；如果业务类型为高速数据业务，则将命令头中指定长度的后续
      <br/>有效字节数据发送给高速数据协处理模块；
      <br/>
				</td></tr><tr><td class="content" id="claim_5">文件管理模块，用于对普通数据业务的命令头中指定长度的后续有效字节
      <br/>数据进行普通数据业务处理，并在完成处理后向智能卡接口传输管理模块返回
      <br/>业务处理结果和状态信息；
      <br/>
				</td></tr><tr><td class="content" id="claim_6">高速数据协处理模块，用于对高速数据业务的命令头中指定长度的后续有
      <br/>效字节数据进行高速数据业务处理，并在完成处理后向高速数据接口传输管理
      <br/>模块返回业务处理结果和状态信息。
      <br/>
				</td></tr><tr><td class="content" id="claim_7">2.根据权利要求1所述的片内操作系统，其特征在于，所述智能卡接口传
      <br/>输管理模块进一步用于检测智能卡接口缓存buffer中是否有数据；如果有，从
      <br/>智能卡接口缓存buffer中读取命令头；如果没有，则继续等待。
      <br/>
				</td></tr><tr><td class="content" id="claim_8">3.根据权利要求2所述的片内操作系统，其特征在于，所述将命令头中指
      <br/>定长度的后续有效字节数据发送给高速数据协处理模块具体包括：应用管理模
      <br/>块通过高速数据接口传输管理模块从高速数据接口接收命令头中指定长度的后
      <br/>续有效字节数据，并将接收到的后续有效字节数据发送给高速数据协处理模块。
      <br/>
				</td></tr><tr><td class="content" id="claim_9">4.根据权利要求2所述的片内操作系统，其特征在于，所述高速数据协处
      <br/>
					理模块进一步用于检测高速数据接口缓存buffer中是否有数据；如果有，从高
      <br/>速数据接口缓存buffer中读取命令头；如果没有，则继续等待。
      <br/>
				</td></tr><tr><td class="content" id="claim_10">5.根据权利要求4所述的片内操作系统，其特征在于，所述将命令头中指
      <br/>定长度的后续有效字节数据发送给高速数据协处理模块具体包括：应用管理模
      <br/>块通过高速数据接口传输管理模块读取高速数据接口缓存buffer中的命令头中
      <br/>指定长度的后续有效字节数据，并将读取到的后续有效字节数据发送给高速数
      <br/>据协处理模块。
      <br/>
				</td></tr><tr><td class="content" id="claim_11">6.根据权利要求1、3或5所述的片内操作系统，其特征在于，在所述高
      <br/>速数据协处理模块在进行高速数据业务处理时，如果需要读写已有存储器中内
      <br/>容，
      <br/>
				</td></tr><tr><td class="content" id="claim_12">则所述高速数据协处理模块进一步用于，通知文件管理模块；接收到文件
      <br/>管理模块返回的处理结果后继续进行高速数据业务处理；
      <br/>
				</td></tr><tr><td class="content" id="claim_13">所述文件管理模块进一步用于，对高速数据协处理模块发送的命令进行相
      <br/>应的文件读写操作，并将处理结果返回给高速数据协处理模块。
      <br/>
				</td></tr><tr><td class="content" id="claim_14">7.根据权利要求6所述的片内操作系统，其特征在于，所述高速数据业务
      <br/>为数字电视数据流解扰业务；所述高速数据接口传输管理模块为数据总线接口
      <br/>传输管理模块；所述高速数据协处理模块为数字电视业务解扰模块；所述命令
      <br/>头为五字节；所述状态信息为两字节。
      <br/>
				</td></tr><tr><td class="content" id="claim_15">8.一种双接口智能卡的片内操作系统的实现方法，其特征在于，该方法包
      <br/>括：
      <br/>
				</td></tr><tr><td class="content" id="claim_16">A、通过对接收到的命令头的安全机制检查后，判断业务类型，如果命令
      <br/>头表明业务类型为普通数据业务，则进行普通数据业务处理；如果命令头表明
      <br/>业务类型为高速数据业务，则进行高速数据业务处理；
      <br/>
				</td></tr><tr><td class="content" id="claim_17">B、返回业务处理结果和状态信息。
      <br/>
				</td></tr><tr><td class="content" id="claim_18">9.根据权利要求8所述的实现方法，其特征在于，步骤A之前，该方法
      <br/>进一步包括检测智能卡接口缓存buffer中是否有数据的步骤；如果有，则从智
      <br/>能卡接口缓存buffer中读取命令头；如果没有，则继续等待。
      <br/>
					
				</td></tr><tr><td class="content" id="claim_19">10.根据权利要求9所述的实现方法，其特征在于，步骤A中的进行高速
      <br/>数据业务处理具体包括：从高速数据接口接收到命令头中指定长度的后续有效
      <br/>字节数据后，对所述后续有效字节数据进行高速数据业务处理。
      <br/>
				</td></tr><tr><td class="content" id="claim_20">11.根据权利要求9所述的实现方法，其特征在于，步骤A之前，该方法
      <br/>进一步包括检测高速数据接口缓存buffer中是否有数据的步骤；如果有：则从
      <br/>高速数据接口缓存buffer中读取命令头；如果没有，则继续等待。
      <br/>
				</td></tr><tr><td class="content" id="claim_21">12.根据权利要求11所述的实现方法，其特征在于，步骤A中的进行高
      <br/>速数据业务处理具体包括：从高速数据接口缓存buffer中读取到命令头中指定
      <br/>长度的后续有效字节数据后，对所述后续有效字节数据进行高速数据业务处理。
      <br/>
				</td></tr><tr><td class="content" id="claim_22">13.根据权利要求10或12所述的实现方法，其特征在于，步骤A中的进
      <br/>行高速数据业务处理进一步包括：如果高速数据业务处理需要读写已有存储器
      <br/>中内容，则通知普通数据业务处理流程进行相关操作并结合普通数据业务处理
      <br/>流程返回的处理结果继续进行高速数据业务处理；步骤B具体包括：通过高速
      <br/>数据接口返回业务处理结果和状态信息。
      <br/>
				</td></tr><tr><td class="content" id="claim_23">14.根据权利要求9或11所述的实现方法，其特征在于，步骤A中的进
      <br/>行普通数据业务处理具体包括：从智能卡接口接收到命令头中指定长度的后续
      <br/>有效字节数据后，对所述后续有效字节数据进行普通数据业务处理，或按照高
      <br/>速数据业务处理流程发送的读写已有存储器中内容的命令进行普通数据业务处
      <br/>理并将处理结果返回高速数据业务处理流程；步骤B具体包括：通过智能卡接
      <br/>口返回业务处理结果和状态信息。
      <br/>
				</td></tr><tr><td class="content" id="claim_24">15.根据权利要求11所述的实现方法，其特征在于，步骤A中的进行普
      <br/>通数据业务处理具体包括：对从高速数据接口缓存buffer中读取的命令头中指
      <br/>定长度的后续有效字节数据进行普通数据业务处理，或按照高速数据业务处理
      <br/>流程发送的读写已有存储器中内容的命令进行普通数据业务处理并将处理结果
      <br/>返回高速数据业务处理流程；步骤B具体包括：通过智能卡接口返回业务处理
      <br/>结果和状态信息。
      <br/>
					
				</td></tr></table></div><div xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:siposeas="java:com.neusoft.sipo.sipopublicsearch.search.app.view.detailUtils.xsltParser.XsltSeasParser" xmlns:str="http://example.com/namespace" class="fullText"><table><tr><td id="description_title" class="header">说明书</td></tr><tr><td class="content" id="description_invention_title">双接口智能卡的片内操作系统及其实现方法
  </td></tr><tr><td class="content" id="description_1">技术领域
  </td></tr><tr><td class="content" id="description_2">本发明涉及智能卡领域，特别涉及一种双接口智能卡的片内操作系统
    (COS，chip operating system)及其实现方法。
    
				</td></tr><tr><td class="content" id="description_3">背景技术
  </td></tr><tr><td class="content" id="description_4">目前，随着科技的不断进步，智能卡应用已经逐渐成为人们生活中不可
    或缺的一部分，其主要应用于安全性要求较高的行业中。从楼宇门禁到移动
    电话、从公交一卡通到校园一卡通、从银行卡到数字电视中的条件接收(CA，
    conditional access)卡，这诸多应用都与智能卡息息相关。随着智能卡应用
    的不断推广与普及，人们对智能卡的功能需求也越来越多样化，丰富多彩的
    应用需求使得智能卡的硬件工艺水平日新月异。
    
				</td></tr><tr><td class="content" id="description_5">智能卡硬件工艺日新月异的发展，必将带来智能卡片内操作系统结构的
    不断变化。图1显示了单接口智能卡片内操作系统的结构图，从图1中可以
    看出，单接口智能卡片内操作系统由传输管理模块101、安全管理模块102、
    应用管理模块103和文件管理模块104组成。传输管理模块101将读取到的
    命令头发送给安全管理模块102；安全管理模块102对接收到的命令头进行
    安全性检查，并将通过检查的命令头发送给应用管理模块103；应用管理模
    块103判断所接收的命令头执行的可能性，如果可行，则通过传输管理模块
    接收后续有效字节数据，并将接收到的后续有效字节数据发送给文件管理模
    块104；文件管理模块104完成对所述后续有效字节数据的处理，并通过传
    输管理模块101返回业务处理结果和状态信息。在这里需要提起注意的是，
    智能卡中的“文件”概念与我们通常所说的“文件”是有区别的。尽管智能卡中
    的文件内存储的也是数据单元或记录，但它们都是与智能卡的具体应用直接
    
					相关的。一般而言，一个具体的应用必然要对应于智能卡中的一个文件。但
    是，由于符合ISO7816标准的单一智能卡接口的数据处理能力有限，因此，
    对于高速数据的传输显得力不从心。
    
				</td></tr><tr><td class="content" id="description_6">比如，在现今流行的数字电视行业中，大部分终端厂家采用基于单一智
    能卡接口的条件接收卡方案来实现数字电视的接收，该方案是通过内嵌一颗
    智能卡芯片来完成认证、鉴权等功能。具体是将需要解扰的数据流放在终端
    来处理，条件接收卡主要完成鉴权、认证、计费等功能，这样密钥需在CA
    卡内完成解析，回传到终端，再由终端根据获得的密钥完成数据解扰，即不
    能实现真正意义上的机卡分离。为了传输数据的安全性，满足密钥不出卡的
    要求，将解扰数据流放在卡内处理成为条件接收卡的一种发展趋势。但若将
    解扰数据流放在条件接收卡内进行，现有的单一智能卡接口必然成为该方案
    实现的一个瓶颈。
    
				</td></tr><tr><td class="content" id="description_7">发明内容
  </td></tr><tr><td class="content" id="description_8">有鉴于此，本发明的主要目的在于提供一种双接口智能卡的片内操作系
    统及其实现方法，使得支持双接口的智能卡具备处理高速数据流的能力。
    
				</td></tr><tr><td class="content" id="description_9">为达到上述目的，本发明的技术方案具体是这样实现的：
    
				</td></tr><tr><td class="content" id="description_10">一种双接口智能卡的片内操作系统，该系统包括：智能卡接口传输管理模
    块、高速数据接口传输管理模块、安全管理模块、应用管理模块、文件管理模
    块和高速数据协处理模块；
    
				</td></tr><tr><td class="content" id="description_11">智能卡接口传输管理模块或高速数据接口传输管理模块，用于读取命令头，
    并将读取到的命令头发送给安全管理模块；
    
				</td></tr><tr><td class="content" id="description_12">安全管理模块，用于对命令头进行安全机制检查，并将通过检查的命令头
    发送给应用管理模块；
    
				</td></tr><tr><td class="content" id="description_13">应用管理模块，用于根据接收到的命令头判断业务类型，如果命令头表明
    业务类型为普通数据业务，则将命令头中指定长度的后续有效字节数据发送给
    文件管理模块；如果业务类型为高速数据业务，则将命令头中指定长度的后续
    
					有效字节数据发送给高速数据协处理模块；
    
				</td></tr><tr><td class="content" id="description_14">文件管理模块，用于对普通数据业务的命令头中指定长度的后续有效字节
    数据进行普通数据业务处理，并在完成处理后向智能卡接口传输管理模块返回
    业务处理结果和状态信息；
    
				</td></tr><tr><td class="content" id="description_15">高速数据协处理模块，用于对高速数据业务的命令头中指定长度的后续有
    效字节数据进行高速数据业务处理，并在完成处理后向高速数据接口传输管理
    模块返回业务处理结果和状态信息。
    
				</td></tr><tr><td class="content" id="description_16">所述智能卡接口传输管理模块进一步用于检测智能卡接口缓存(buffer)中
    是否有数据；如果有，从智能卡接口缓存(buffer)中读取命令头；如果没有，
    则继续等待。
    
				</td></tr><tr><td class="content" id="description_17">所述将命令头中指定长度的后续有效字节数据发送给高速数据协处理模块
    具体包括：应用管理模块通过高速数据接口传输管理模块从高速数据接口接收
    命令头中指定长度的后续有效字节数据，并将接收到的后续有效字节数据发送
    给高速数据协处理模块。
    
				</td></tr><tr><td class="content" id="description_18">所述高速数据协处理模块进一步用于检测高速数据接口缓存(buffer)中是
    否有数据；如果有，从高速数据接口缓存(buffer)中读取命令头；如果没有，
    则继续等待。
    
				</td></tr><tr><td class="content" id="description_19">所述将命令头中指定长度的后续有效字节数据发送给高速数据协处理模块
    具体包括：应用管理模块通过高速数据接口传输管理模块读取高速数据接口缓
    存(buffer)中的命令头中指定长度的后续有效字节数据，并将读取到的后续有
    效字节数据发送给高速数据协处理模块。
    
				</td></tr><tr><td class="content" id="description_20">在所述高速数据协处理模块在进行高速数据业务处理时，如果需要读写已
    有存储器中内容，
    
				</td></tr><tr><td class="content" id="description_21">则所述高速数据协处理模块进一步用于，通知文件管理模块；接收到文件
    管理模块返回的处理结果后继续进行高速数据业务处理；
    
				</td></tr><tr><td class="content" id="description_22">所述文件管理模块进一步用于，对高速数据协处理模块发送的命令进行相
    应的文件读写操作，并将处理结果返回给高速数据协处理模块。
    
				</td></tr><tr><td class="content" id="description_23">所述高速数据业务为数字电视数据流解扰业务；所述高速数据接口传输管
    理模块为数据总线接口传输管理模块；所述高速数据协处理模块为数字电视业
    务解扰模块；所述命令头为五字节；所述状态信息为两字节。
    
				</td></tr><tr><td class="content" id="description_24">一种双接口智能卡的片内操作系统的实现方法，该方法包括：
    
				</td></tr><tr><td class="content" id="description_25">A、通过对接收到的命令头的安全机制检查后，判断业务类型，如果命令
    头表明业务类型为普通数据业务，则进行普通数据业务处理；如果命令头表明
    业务类型为高速数据业务，则进行高速数据业务处理；
    
				</td></tr><tr><td class="content" id="description_26">B、返回业务处理结果和状态信息。
    
				</td></tr><tr><td class="content" id="description_27">该方法进一步包括检测智能卡接口缓存(buffer)中是否有数据的步骤；如
    果有，则从智能卡接口缓存(buffer)中读取命令头；如果没有，则继续等待。
    
				</td></tr><tr><td class="content" id="description_28">步骤A中的进行高速数据业务处理具体包括：从高速数据接口接收到命令
    头中指定长度的后续有效字节数据后，对所述后续有效字节数据进行高速数据
    业务处理。
    
				</td></tr><tr><td class="content" id="description_29">步骤A之前，该方法进一步包括检测高速数据接口缓存(buffer)中是否有
    数据的步骤；如果有：则从高速数据接口缓存(buffer)中读取命令头；如果没
    有，则继续等待。
    
				</td></tr><tr><td class="content" id="description_30">步骤A中的进行高速数据业务处理具体包括：从高速数据接口缓存(buffer)
    中读取命令头中指定长度的后续有效字节数据后，对所述后续有效字节数据进
    行高速数据业务处理。
    
				</td></tr><tr><td class="content" id="description_31">步骤A中的进行高速数据业务处理进一步包括：如果高速数据业务处理需
    要读写已有存储器中内容，则通知普通数据业务处理流程进行相关操作并结合
    普通数据业务处理流程返回的处理结果继续进行高速数据业务处理；步骤B具
    体包括：通过高速数据接口返回业务处理结果和状态信息。
    
				</td></tr><tr><td class="content" id="description_32">步骤A中的进行普通数据业务处理具体包括：从智能卡接口接收到命令头
    中指定长度的后续有效字节数据后，对所述后续有效字节数据进行普通数据业
    务处理，或按照高速数据业务处理流程发送的读写已有存储器中内容的命令进
    行普通数据业务处理并将处理结果返回高速数据业务处理流程；步骤B具体包
    
					括：通过智能卡接口返回业务处理结果和状态信息。
    
				</td></tr><tr><td class="content" id="description_33">步骤A中的进行普通数据业务处理具体包括：对从高速数据接口缓存
    (buffer)中读取的命令头中指定长度的后续有效字节数据进行普通数据业
    务处理，或按照高速数据业务处理流程发送的读写已有存储器中内容的命令
    进行普通数据业务处理并将处理结果返回高速数据业务处理流程；步骤B
    具体包括：通过智能卡接口返回业务处理结果和状态信息。
    
				</td></tr><tr><td class="content" id="description_34">由上述的技术方案可见，本发明提供的一种双接口智能卡的片内操作系
    统及其实现方法应用于具有智能卡接口和高速数据接口的双接口智能卡，摆
    脱了传统智能卡接口的条件束缚，使得高速数据的传输成为可能，提高了智
    能卡的处理能力和处理效率。本发明的实施例中，将解扰数据流放在条件接
    收卡内处理，解决了数字电视业务中密钥不出卡的机卡分离问题。
    
				</td></tr><tr><td class="content" id="description_35">附图说明
  </td></tr><tr><td class="content" id="description_36">图1为现有技术中智能卡片内操作系统的结构示意图；
    
				</td></tr><tr><td class="content" id="description_37">图2为本发明双接口智能卡片内操作系统的结构示意图；
    
				</td></tr><tr><td class="content" id="description_38">图3为本发明中双接口智能卡片内操作系统的单线程业务处理模式的
    流程图；
    
				</td></tr><tr><td class="content" id="description_39">图4为本发明中双接口智能卡片内操作系统的双线程业务处理模式的
    流程图；
    
				</td></tr><tr><td class="content" id="description_40">图5为本发明实施例中双接口智能卡片内操作系统应用于数字电视业
    务中的业务流程图。
    
				</td></tr><tr><td class="content" id="description_41">具体实施方式
  </td></tr><tr><td class="content" id="description_42">为使本发明的目的、技术方案、及优点更加清楚明白，以下参照附图并
    举实施例，对本发明进一步详细说明。
    
				</td></tr><tr><td class="content" id="description_43">本发明的主要思想是：通过对接收到的命令头的安全机制检查后，判断
    业务类型，如果命令头表明业务类型为普通数据业务，则进行普通数据业务
    
					处理；如果命令头表明业务类型为高速数据业务，则进行高速数据业务处理。
    
				</td></tr><tr><td class="content" id="description_44">根据ISO7816协议，智能卡接口解析命令是通过判断五个命令字节来进
    行的，即把接收到的前五个字节作为命令头，表明该条命令是完成什么操作
    的；后续字节是信息字节，表明该命令所携带的信息。本发明对高速数据接
    口接收的数据也采用命令解析的形式，即收到的前五个数据字节为命令头。
    
				</td></tr><tr><td class="content" id="description_45">智能卡的标准状态信息为两字节，本发明同样用两字节作为高速数据业
    务处理后产生的状态信息。具体的字节定义可以参照ISO7816协议或者自定
    义，这里不再赘述。
    
				</td></tr><tr><td class="content" id="description_46">智能卡支持两类信息交换协议，即异步字符传输的T＝0协议以及异步
    分组传输的T＝1协议，本发明中以异步字符传输的T＝0协议为例进行说明。
    
				</td></tr><tr><td class="content" id="description_47">图2为本发明所述双接口智能卡片内操作系统的结构图。参见图2，该
    片内操作系统包括：智能卡接口传输管理模块201、高速数据接口传输管理
    模块202、安全管理模块203、应用管理模块204、文件管理模块205和高
    速数据协处理模块206。
    
				</td></tr><tr><td class="content" id="description_48">该片内操作系统具有两种工作模式，即单线程模式和双线程模式，实际
    工作中可以根据需要选用其中一种工作模式。
    
				</td></tr><tr><td class="content" id="description_49">单线程模式
    
				</td></tr><tr><td class="content" id="description_50">智能卡复位后，智能卡接口传输管理模块201检测智能卡接口的缓存
    (buffer)内是否有数据；如果有，读取五个字节的命令头，并将该命令头
    发送给安全管理模块203；如果没有，则继续等待；
    
				</td></tr><tr><td class="content" id="description_51">根据T＝0协议，智能卡接口分别接收命令头和命令头指定长度的后续
    有效字节数据；此时如果智能卡接口的缓存(buffer)内有数据，则该数据
    为五个字节的命令头；
    
				</td></tr><tr><td class="content" id="description_52">安全管理模块203根据该命令头判断命令的合法性，然后进行命令的安
    全级别和安全属性验证，如果通过，将该命令头传送给应用管理模块204，
    否则，将状态信息通过智能卡接口传输管理模块201返回到智能卡接口的缓
    存(buffer)中从智能卡接口发送出智能卡；
    
				</td></tr><tr><td class="content" id="description_53">关于安全管理模块203如何进行各种安全管理操作为本领域普通技术
    人员的惯用技术手段且不是本发明的重点，这里不再赘述；
    
				</td></tr><tr><td class="content" id="description_54">应用管理模块204根据命令头判断要执行操作的业务类型；如果命令头
    表明业务类型为普通数据业务，则通过智能卡传输管理模块201从智能卡接
    口接收命令头中指定长度的后续有效字节数据，并将接收到的后续有效字节
    数据发送给文件管理模块205；如果命令头表明业务类型为高速数据业务，
    则通过高速数据传输管理模块从高数数据接口接收命令头中指定长度的后
    续有效字节数据，并将接收到的后续有效字节数据发送给高速数据协处理模
    块206；如果命令头业务类型错误，将状态信息通过智能卡接口传输管理模
    块201返回到智能卡接口的缓存(buffer)中从智能卡接口发送出智能卡；
    
				</td></tr><tr><td class="content" id="description_55">如果命令头表明业务类型为普通数据业务，应用管理模块204通知智能
    卡传输管理模块201检测智能卡接口的缓存(buffer)中是否有数据，如果
    没有，继续等待；如果有数据，该数据为命令头中指定长度的后续有效字节
    数据，智能卡传输管理模块201接收该后续有效字节数据，并将接收到的后
    续有效字节数据发送给应用管理模块204；应用管理模块204再将接收到的
    后续有效字节数据发送给文件管理模块205；
    
				</td></tr><tr><td class="content" id="description_56">如果命令头表明业务类型为高速数据业务，应用管理模块204通知高速
    数据传输管理模块202检测高速数据接口的缓存(buffer)中是否有数据，
    如果没有，继续等待；如果有数据，该数据为命令头中指定长度的后续有效
    字节数据，高速数据传输管理模块202接收该后续有效字节数据，并将接收
    到的后续有效字节数据发送给应用管理模块204；应用管理模块204再将接
    收到的后续有效字节数据发送给高速数据协处理模块206；
    
				</td></tr><tr><td class="content" id="description_57">文件管理模块205接收所述后续有效字节数据或高速数据协处理模块
    206发送的读写已有存储器中内容的命令，按照命令类型完成读写已有存储
    器中内容的工作，并判断是否为高速数据业务，如果是，将处理结果返回高
    速数据协处理模块206处理；如果不是，将处理结果和状态信息通过智能卡
    接口传输管理模块201返回到智能卡接口的缓存(buffer)中从智能卡接口
    
					发送出智能卡；
    
				</td></tr><tr><td class="content" id="description_58">高速数据协处理模块206对接收到的所述后续有效字节数据进行高速
    数据业务处理，并判断是否需要读写已有存储器中内容，如果是，将通知文
    件管理模块205进行相应的存储器读写操作并在接收到文件管理模块205返
    回的处理结果后继续进行高速数据业务处理，然后将业务处理结果和状态信
    息通过高速数据接口传输管理模块202返回到高速数据接口的缓存(buffer)
    中从高速数据接口发送出智能卡；如果不是，直接将业务处理结果和状态信
    息通过高速数据接口传输管理模块202返回到高速数据接口的缓存(buffer)
    中从高速数据接口发送出智能卡；
    
				</td></tr><tr><td class="content" id="description_59">高速数据协处理模块206主要用于处理高速数据业务，例如数字电视业
    务中的数据加、解扰运算的处理；高速数据接口，比如通用输入/输出(I/O)
    接口，上可以使用现有的MMC、USB以及其他高速数据传输协议或自行定
    制协议，传输时序也可以根据需要定制。
    
				</td></tr><tr><td class="content" id="description_60">双线程模式
    
				</td></tr><tr><td class="content" id="description_61">智能卡复位后，智能卡接口传输管理模块201检测智能卡接口的缓存
    (buffer)内是否有数据，如果有，读取五个字节的命令头，并将命令头传
    送给安全管理模块203，如果没有，则通知高速数据接口传输管理模块202
    检测数据；
    
				</td></tr><tr><td class="content" id="description_62">根据T＝0协议，智能卡接口分别接收命令头和命令头指定长度的后续
    有效字节数据；此时如果智能卡接口的缓存(buffer)内有数据，则该数据
    为五个字节的命令头；
    
				</td></tr><tr><td class="content" id="description_63">高速数据接口传输管理模块202检测高速数据接口的缓存(buffer)内
    是否有数据，如果有，读取五个字节的命令头，并将该命令头发送给安全管
    理模块203，如果没有，则继续等待；
    
				</td></tr><tr><td class="content" id="description_64">高速数据接口可以分别接收命令头和命令头指定长度的后续有效字节
    数据，也可以一次性同时接收命令头和命令头指定长度的后续有效字节数
    据，可以根据需要选定接收方式；本发明以高速数据接口一次性同时接收命
    
					令头和命令头指定长度的后续有效字节数据为例，此时如果高速数据接口的
    缓存(buffer)内有数据，则该数据为五个字节的命令头和命令头指定长度
    的后续有效字节数据；
    
				</td></tr><tr><td class="content" id="description_65">安全管理模块203根据该命令头判断命令的合法性，然后进行命令的安
    全级别和安全属性验证，如果通过，将命令头传送给应用管理模块204，否
    则，将状态信息通过智能卡接口传输管理模块201返回到智能卡接口的缓存
    (buffer)中从智能卡接口发送出智能卡；
    
				</td></tr><tr><td class="content" id="description_66">关于安全管理模块203如何进行各种安全管理操作为本领域普通技术
    人员的惯用技术手段且不是本发明的重点，这里不再赘述；
    
				</td></tr><tr><td class="content" id="description_67">应用管理模块204根据命令头判断要执行操作的业务类型；如果命令头
    表明业务类型为普通数据业务并且是从智能卡接口接收的该命令头，则通过
    智能卡传输管理模块201接收命令头中指定长度的后续有效字节数据，并将
    接收到的后续有效字节数据发送给文件管理模块205；如果命令头表明业务
    类型为普通数据业务并且是从高速数据接口接收的该命令头，则通过高速数
    据传输管理模块202读取高速数据接口的缓存(buffer)中的命令头中指定
    长度的后续有效字节数据并发送给文件管理模块205；如果命令头表明业务
    类型为高速数据业务，则通过高速数据传输管理模块202读取高速数据接口
    的缓存(buffer)中的命令头中指定长度的后续有效字节数据并发送给高速
    数据协处理模块206；如果命令头业务类型错误，将状态信息通过智能卡接
    口传输管理模块201返回到智能卡接口的缓存(buffer)中从智能卡接口发
    送出智能卡；
    
				</td></tr><tr><td class="content" id="description_68">如果命令头表明业务类型为普通数据业务并且是从智能卡接口接收的
    该命令头，应用管理模块204通知智能卡传输管理模块201检测智能卡接口
    的缓存(buffer)中是否有数据，如果没有，继续等待；如果有数据，该数
    据为命令头中指定长度的后续有效字节数据，智能卡传输管理模块201接收
    该后续有效字节数据，并将接收到的后续有效字节数据发送给应该管理模块
    204；应用管理模块204再将接收到的后续有效字节数据发送给文件管理模
    
					块205；
    
				</td></tr><tr><td class="content" id="description_69">文件管理模块205接收所述后续有效字节数据或高速数据协处理模块
    206发送的读写已有存储器中内容的命令，按照命令类型完成读写已有存储
    器中内容的工作，并判断是否为高速数据业务，如果是，将处理结果返回高
    速数据协处理模块206；如果不是，将处理结果和状态信息通过智能卡接口
    传输管理模块201返回到智能卡接口的缓存(buffer)中从智能卡接口发送
    出智能卡；
    
				</td></tr><tr><td class="content" id="description_70">高速数据协处理模块206对接收到的所述后续有效字节数据进行高速
    数据业务处理，并判断是否需要读写已有存储器中内容，如果是，将通知文
    件管理模块205进行相应的存储器读写操作并在接收到文件管理模块205返
    回的处理结果后继续进行高速数据业务处理，高速数据业务处理完成后再将
    业务处理结果和状态信息通过高速数据接口传输管理模块202返回到高速
    数据接口的缓存(buffer)中从高速数据接口发送出智能卡；如果不是，直
    接将业务处理结果和状态信息通过高速数据接口传输管理模块202返回到
    高速数据接口的缓存(buffer)中从高速数据接口发送出智能卡；
    
				</td></tr><tr><td class="content" id="description_71">高速数据协处理模块206主要用于处理高速数据业务，例如数字电视业
    务中的数据加、解扰运算的处理；高速数据接口，比如通用输入/输出(I/O)
    接口，上可以使用现有的MMC、USB以及其他高速数据传输协议或自行定
    制协议，传输时序也可以根据需要定制。
    
				</td></tr><tr><td class="content" id="description_72">在以上的双线程模式中，智能卡接口传输管理模块201和高速数据接口
    传输管理模块202的检测次序可以互换，可以根据需要确定先检测智能卡接
    口还是高速数据接口；普通数据业务可通过智能卡接口发送到智能卡，亦可
    通过高速数据接口发送，而高速数据业务则只能通过高速数据接口发送到智
    能卡。
    
				</td></tr><tr><td class="content" id="description_73">图3为本发明中双接口智能卡片内操作系统的单线程业务处理模式的
    流程图。参见图3，智能卡复位后，一直处于等待、接收、处理的循环之中。
    
				</td></tr><tr><td class="content" id="description_74">步骤301：检测智能卡接口的缓存(buffer)内是否有数据，如果有，
    
					执行步骤302；如果没有，则继续等待；
    
				</td></tr><tr><td class="content" id="description_75">根据T＝0协议，智能卡接口分别接收命令头和命令头指定长度的后续
    有效字节数据；此时如果智能卡接口的缓存(buffer)内有数据，则该数据
    为五个字节的命令头；
    
				</td></tr><tr><td class="content" id="description_76">步骤302：读取五个字节的命令头；
    
				</td></tr><tr><td class="content" id="description_77">步骤303：根据该命令头判断该命令的合法性，然后进行命令的安全级
    别和安全属性的验证；如果通过执行步骤304；如果任一项不通过，则执行
    步骤308；
    
				</td></tr><tr><td class="content" id="description_78">步骤304：根据该命令头判断要执行操作的业务类型；如果命令头表明
    业务类型为普通数据业务，则执行步骤305；如果命令头表明业务类型为高
    速数据业务，则执行步骤309；
    
				</td></tr><tr><td class="content" id="description_79">步骤305：从智能卡接口接收后续有效字节数据；
    
				</td></tr><tr><td class="content" id="description_80">需要再次检测智能卡接口的缓存(buffer)内是否有数据，如果有数据，
    该数据为命令头中指定长度的后续有效字节数据，则接收该后续有效字节数
    据；如果没有，则继续等待；
    
				</td></tr><tr><td class="content" id="description_81">步骤306：按照命令类型读写已有存储器中内容；
    
				</td></tr><tr><td class="content" id="description_82">对于接收到的后续有效字节数据或步骤311发送来的读写已有存储器
    中内容的命令进行处理；
    
				</td></tr><tr><td class="content" id="description_83">步骤307：判断是否为高速数据业务，如果是，则将业务处理结果返回
    步骤310；如果不是，则执行步骤308；
    
				</td></tr><tr><td class="content" id="description_84">步骤308：从智能卡接口返回状态信息和业务处理结果，并继续等待；
    
				</td></tr><tr><td class="content" id="description_85">步骤309：从高速数据接口接收后续有效字节数据；
    
				</td></tr><tr><td class="content" id="description_86">需要检测高速数据接口的缓存(buffer)内是否有数据，如果有数据，
    该数据为命令头中指定长度的后续有效字节数据，则接收该后续有效字节数
    据；如果没有，则继续等待；
    
				</td></tr><tr><td class="content" id="description_87">步骤310：进行高速数据业务处理流程；
    
				</td></tr><tr><td class="content" id="description_88">对于接收到的后续有效字节数据或步骤307返回的业务处理结果进行
    
					处理，主要是一些算法处理，比如数字电视业务中的加、解扰数据流的操作。
    
				</td></tr><tr><td class="content" id="description_89">步骤311：判断是否需要读写已有存储器中内容，如果是，执行步骤306，
    如果否，则执行步骤312；
    
				</td></tr><tr><td class="content" id="description_90">步骤312：从高速数据接口返回状态信息和业务处理结果，并继续等待。
    
				</td></tr><tr><td class="content" id="description_91">图4为本发明中双接口智能卡片内操作系统的双线程业务处理模式的
    流程图。参见图4，智能卡上电后，一直处于等待、接收、处理的循环之中。
    
				</td></tr><tr><td class="content" id="description_92">步骤401：检测智能卡接口的缓存(buffer)内是否有数据，如果有，
    执行步骤403；如果没有，则执行步骤402；
    
				</td></tr><tr><td class="content" id="description_93">根据T＝0协议，智能卡接口分别接收命令头和命令头指定长度的后续
    有效字节数据；此时如果智能卡接口的缓存(buffer)内有数据，则该数据
    为五个字节的命令头；
    
				</td></tr><tr><td class="content" id="description_94">步骤402：检测高速数据接口的缓存内是否有数据，如果有，执行步骤
    403；如果没有，则继续等待；
    
				</td></tr><tr><td class="content" id="description_95">高速数据接口可以分别接收命令头和命令头指定长度的后续有效字节
    数据，也可以一次性同时接收命令头和命令头指定长度的后续有效字节数
    据，可以根据需要选定接收方式；本发明以高速数据接口一次性同时接收命
    令头和命令头指定长度的后续有效字节数据为例，此时如果高速数据接口的
    缓存(buffer)内有数据，则该数据为五个字节的命令头和命令头中指定长
    度的后续有效字节数据；
    
				</td></tr><tr><td class="content" id="description_96">步骤403：读取五个字节的命令头；
    
				</td></tr><tr><td class="content" id="description_97">步骤404：根据该命令头判断命令的合法性，然后进行命令安全级别和
    安全属性的验证；如果通过执行步骤405；如果任一项不通过，则执行步骤
    409；
    
				</td></tr><tr><td class="content" id="description_98">步骤405：根据该命令头判断要执行操作的业务类型；如果命令头表明
    业务类型为普通数据业务并且是从智能卡接口接收的该命令头，则执行步骤
    406；如果命令头表明业务类型为普通数据业务并且是从高速数据接口接收
    的该命令头，则执行步骤407；如果命令头表明业务类型为高速数据业务，
    
					则执行步骤410；
    
				</td></tr><tr><td class="content" id="description_99">步骤406：从智能卡接口接收后续有效字节数据；
    
				</td></tr><tr><td class="content" id="description_100">需要检测智能卡接口的缓存(buffer)内是否有数据，如果有数据，该
    数据为命令头中指定长度的后续有效字节数据，则接收该后续有效字节数
    据；如果没有，则继续等待；
    
				</td></tr><tr><td class="content" id="description_101">步骤407：按照命令类型读写已有存储器中内容；
    
				</td></tr><tr><td class="content" id="description_102">对于接收到的后续有效字节数据、从智能卡接口的缓存(buffer)内读
    取的后续有效字节数据或步骤411发送来的读写已有存储器中内容的命令
    进行处理；
    
				</td></tr><tr><td class="content" id="description_103">步骤408：判断是否为高速数据业务，如果是，则返回业务处理结果到
    步骤410；如果不是，则执行步骤409；
    
				</td></tr><tr><td class="content" id="description_104">步骤409：从智能卡接口返回状态信息和业务处理结果，并继续等待；
    
				</td></tr><tr><td class="content" id="description_105">步骤410：进行高速数据业务处理流程；
    
				</td></tr><tr><td class="content" id="description_106">对于从智能卡接口的缓存(buffer)内读取的后续有效字节数据或步骤
    408返回的业务处理结果进行处理，主要是一些算法处理，比如数字电视业
    务中的加、解扰数据流的操作。
    
				</td></tr><tr><td class="content" id="description_107">步骤411：判断是否需要读写已有存储器中内容，如果是，执行步骤407，
    如果否，则执行步骤412；
    
				</td></tr><tr><td class="content" id="description_108">步骤412：从高速数据接口返回状态信息和业务处理结果，并继续等待。
    
				</td></tr><tr><td class="content" id="description_109">以上步骤401和步骤402的次序可以互换，先检测智能卡接口还是高速
    数据接口可根据需要来确定。
    
				</td></tr><tr><td class="content" id="description_110">图5为本发明实施例中双接口智能卡片内操作系统应用于数字电视业
    务中的业务流程图。参见图5，本实施例采用的条件接收(CA)卡能同时支
    持两种接口传输数据，一种是智能卡接口，支持T＝0协议，其对应的传输管
    理模块为智能卡接口传输管理模块；另一种是数据总线接口，数据总线的位
    数可根据需要确定为4位、8位或16位，其对应的传输管理模块为数据总
    线接口传输管理模块。条件接收卡中的存储器为闪存(flash)，存储着密钥
    
					种子、卡片信息、计费明细和节目信息等。本实施例中的高速数据协处理模
    块为数字电视业务解扰模块。终端向条件接收卡发送的数据有：第一信息流、
    第二信息流和需要解扰的数据流。
    
				</td></tr><tr><td class="content" id="description_111">其中第一信息流中包含表明第一信息流所属的CA标识符、密钥种子ID
    号以及授权和产品信息等信息；第二信息流中包含表明本流所属的CA标识、
    控制字密文、节目信息等信息；解扰数据流中包含需要解扰的节目内容数据。
    
				</td></tr><tr><td class="content" id="description_112">为了描述方便，本发明中实施例中所需业务命令头做以下设定：
    
				</td></tr><tr><td class="content" id="description_113">表1所示为第一信息流的命令头格式：
    
				</td></tr><tr><td class="content" id="description_114"> 
						<table face="仿宋" align="" width="" cellspacing="" border="" frame="">
							
								
								
								
								
								
								
									<tr valign="" align="">
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">命令字节1</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">命令字节2</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">命令字节3</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">命令字节4</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">命令字节5</td>
									</tr>
								
								
									<tr valign="" align="">
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">80</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">30</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">保留</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">保留</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">后续字节长度</td>
									</tr>
								
							
						</table>
					
					
				</td></tr><tr><td class="content" id="description_115">表1
    
				</td></tr><tr><td class="content" id="description_116">表2所示为第二信息流的命令头格式：
    
				</td></tr><tr><td class="content" id="description_117"> 
						<table face="仿宋" align="" width="" cellspacing="" border="" frame="">
							
								
								
								
								
								
								
									<tr valign="" align="">
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">命令字节1</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">命令字节2</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">命令字节3</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">命令字节4</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">命令字节5</td>
									</tr>
								
								
									<tr valign="" align="">
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">80</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">31</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">保留</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">保留</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">后续字节长度</td>
									</tr>
								
							
						</table>
					
					
				</td></tr><tr><td class="content" id="description_118">表2
    
				</td></tr><tr><td class="content" id="description_119">表3所示为解扰数据流的命令头格式：
    
				</td></tr><tr><td class="content" id="description_120"> 
						<table face="仿宋" align="" width="" cellspacing="" border="" frame="">
							
								
								
								
								
								
								
									<tr valign="" align="">
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">命令字节1</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">命令字节2</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">命令字节3</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">命令字节4</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">命令字节5</td>
									</tr>
								
								
									<tr valign="" align="">
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">80</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">32</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">保留</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">保留</td>
										<td id="" valign="" width="" align="" rowspan="1" colspan="NaN">后续字节长度</td>
									</tr>
								
							
						</table>
					
					
				</td></tr><tr><td class="content" id="description_121">表3
    
				</td></tr><tr><td class="content" id="description_122">上述表中，命令字节1代表命令的类型，80代表数字电视业务；命令
    字节2表示命令编码，30、31和32分别代表第一信息流、第二信息流和解
    扰数据流；命令字节3和和命令字节4为具体命令参数，可以根据需要自定
    义；命令字节5表示后续字节的长度。
    
				</td></tr><tr><td class="content" id="description_123">下面具体说明双接口智能卡片内操作系统以单线程模式和双线程模式
    分别处理数字电视业务的流程：
    
				</td></tr><tr><td class="content" id="description_124">1)当本发明的双接口智能卡片内操作系统工作于单线程模式时，
    
				</td></tr><tr><td class="content" id="description_125">接收第一信息流；
    
				</td></tr><tr><td class="content" id="description_126">当智能卡接口传输管理模块从智能卡接口的缓存(buffer)内检测到数
    据，则读取五个字节的命令头并将其发送给安全管理模块；安全管理模块根
    据该命令头判断命令的合法性，然后对命令进行安全级别和安全属性的验
    证，将验证通过的命令头发送给应用管理模块；应用管理模块根据命令字节
    1的值“80”和命令字节2的值“30”来判断其业务类型，这里为数字电视
    业务的第一信息流，属于普通数据业务，则通过智能卡传输管理模块从智能
    卡接口接收命令字节5中指定长度的后续有效字节数据，即第一信息流，并
    将接收到的后续有效字节数据发送给文件管理模块；文件管理模块接收所述
    第一信息流并根据第一信息流中携带的业务密钥种子ID号，找到条件接收
    卡存储器flash中存储的与之相对应的业务密钥，存储该业务密钥，为解控
    制字使用，并将处理结果和状态信息通过智能卡接口传输管理模块返回到智
    能卡接口的缓存(buffer)中从智能卡接口发送出智能卡；
    
				</td></tr><tr><td class="content" id="description_127">接收第二信息流；
    
				</td></tr><tr><td class="content" id="description_128">当智能卡接口传输管理模块从智能卡接口的缓存(buffer)内检测到数
    据，则读取五个字节的命令头并将其传送给安全管理模块；安全管理模块根
    据该命令头判断命令的合法性，然后对命令进行安全级别和安全属性的验
    证，将验证通过的命令头发送给应用管理模块；应用管理模块根据命令字节
    1的值“80”和命令字节2的值“31”来判断其业务类型，这里为数字电视
    业务的第二信息流，属于普通数据业务，则通过智能卡传输管理模块从智能
    卡接口接收命令字节5中指定长度的后续有效字节数据，即第二信息流，并
    将接收到的后续有效字节数据发送给文件管理模块；文件管理模块接收所述
    第二信息流并根据第一信息流的业务密钥解密第二信息流中携带的控制字
    信息，存储该控制字信息，为解扰使用，并将处理结果和状态信息通过智能
    卡接口传输管理模块返回到智能卡接口的缓存(buffer)中从智能卡接口发
    送出智能卡；
    
				</td></tr><tr><td class="content" id="description_129">接收解扰数据流；
    
				</td></tr><tr><td class="content" id="description_130">当智能卡接口传输管理模块从智能卡接口的缓存(buffer)内检测到数
    据，则读取五个字节的命令头并将其传送给安全管理模块；安全管理模块根
    据该命令头判断命令的合法性，然后对命令进行安全级别和安全属性的验
    证，将验证通过的命令头发送给应用管理模块；应用管理模块根据命令字节
    1的值“80”和命令字节2的值“32”来判断其业务数据类型，这里为数字
    电视业务的解扰数据流，属于高速数据业务，则通过数据总线接口传输管理
    模块从数据总线接口接收命令字节5中指定长度的后续有效字节数据，即为
    解扰数据流，并将接收到的后续有效字节数据发送给数字电视业务解扰模
    块；数字电视业务解扰模块对接收到的解扰数据流进行解扰操作，因为解扰
    数据流需要用到第二信息流的控制字，所以通知文件管理模块从存储器flash
    中读取第二信息流的控制字并利用文件管理模块返回的第二信息流的控制
    字解扰该解扰数据流，最后将明文数据流和状态信息通过数据总线接口传输
    管理模块返回到数据总线接口的缓存(buffer)中从数据总线接口发送出智
    能卡；
    
				</td></tr><tr><td class="content" id="description_131">从智能卡接口接收收到的其他命令可能是创建文件、访问文件安全认证
    等，都是智能卡的标准命令，属于本领域普通技术人员的惯用技术手段且不
    是本发明的重点，这里不再赘述。
    
				</td></tr><tr><td class="content" id="description_132">2)当本发明的双接口智能卡片内操作系统工作于双线程模式时，
    
				</td></tr><tr><td class="content" id="description_133">如果通过智能卡接口接收第一信息流和第二信息流，则接收第一信息流
    和第二信息流的流程与单线程模式相同；
    
				</td></tr><tr><td class="content" id="description_134">接收解扰数据流
    
				</td></tr><tr><td class="content" id="description_135">当数据总线接口传输管理模块从数据总线接口的缓存(buffer)内检测
    到数据，则读取五个字节的命令头，并将所述命令头发送给安全管理模块；
    安全管理模块根据该命令头判断命令的合法性，然后对命令进行安全级别和
    安全属性的验证，将验证通过的命令头发送给应用管理模块；应用管理模块
    根据命令字节1的值“80”和命令字节2的值“32”来判断其业务类型，这
    
					里为数字电视业务的解扰数据流，属于高速数据业务，则通过并行总线传输
    管理模块读取并行总线接口的缓存(buffer)中的命令字节5中指定长度的
    后续有效字节数据，即解扰数据流，并将读取到的后续有效字节数据发送给
    数字电视业务解扰模块；数字电视业务解扰模块对接收到的解扰数据流进行
    解扰操作，因为解扰数据流需要用到第二信息流的控制字，所以通知文件管
    理模块从存储器flash中读取第二信息流的控制字并利用文件管理模块返回
    的第二信息流的控制字解扰该解扰数据流，最后将明文数据流和状态信息通
    过数据总线接口传输管理模块返回到数据总线接口的缓存(buffer)中从数
    据总线接口发送出智能卡；
    
				</td></tr><tr><td class="content" id="description_136">从智能卡接口接收到的其他指令可能是创建文件、访问文件安全认证
    等，都是智能卡的标准命令，属于本领域普通技术人员的惯用技术手段且不
    是本发明的重点，这里不再赘述。
    
				</td></tr><tr><td class="content" id="description_137">在上述双线程模式中，第一信息流和第二信息流可通过智能卡接口发送
    到智能卡，还可以通过数据总线接口发送，选择哪种方式发送可以通过条件
    接收卡上的智能卡控制器来控制，下面介绍一下第一信息流和第二信息流通
    过数据总线接口发送的情况：
    
				</td></tr><tr><td class="content" id="description_138">3)当本发明的双接口智能卡片内操作系统工作于双线程模式时，
    
				</td></tr><tr><td class="content" id="description_139">接收第一信息流
    
				</td></tr><tr><td class="content" id="description_140">当数据总线接口传输管理模块从数据总线接口的缓存(buffer)内检测
    到数据，则读取五个字节的命令头，并将所述命令头发送给安全管理模块；
    安全管理模块根据该命令头判断命令的合法性，然后对命令进行安全级别和
    安全属性的验证，将验证通过的命令头发送给应用管理模块；应用管理模块
    根据命令字节1的值“80”和命令字节2的值“30”来判断其业务类型，这
    里为数字电视业务的第一信息流，属于普通数据业务，则通过并行总线传输
    管理模块读取并行总线接口的缓存(buffer)中的命令字节5中指定长度的
    后续有效字节数据，即第一信息流，并将读取到的后续有效字节数据发送给
    文件管理模块；文件管理模块接收所述第一信息流并根据第一信息流中携带
    
					的业务密钥种子ID号，找到条件接收卡存储器flash中存储的与之相对应的
    业务密钥，存储该业务密钥，为解控制字使用，并将处理结果和状态信息通
    过智能卡接口传输管理模块返回到智能卡接口的缓存(buffer)中从智能卡
    接口发送出智能卡；
    
				</td></tr><tr><td class="content" id="description_141">接收第二信息流
    
				</td></tr><tr><td class="content" id="description_142">当数据总线接口传输管理模块从数据总线接口的缓存(buffer)内检测
    到数据，则读取五个字节的命令头，并将所述命令头发送给安全管理模块；
    安全管理模块根据该命令头判断命令的合法性，然后对命令进行安全级别和
    安全属性的验证，将验证通过的命令头发送给应用管理模块；应用管理模块
    根据命令字节1的值“80”和命令字节2的值“31”来判断其业务数据类型，
    这里为数字电视业务的第二信息流，属于普通数据业务，则通过并行总线传
    输管理模块读取并行总线接口的缓存(buffer)中的命令字节5中指定长度
    的后续有效字节数据，即第二信息流，并将读取到的后续有效字节数据发送
    给文件管理模块；文件管理模块接收所述第二信息流并根据存储的第一信息
    流的业务密钥解密第二信息流中携带的控制字信息，存储该控制字信息，为
    解扰使用，并将处理结果和状态信息通过智能卡接口传输管理模块返回到智
    能卡接口的缓存(buffer)中从智能卡接口发送出智能卡；
    
				</td></tr><tr><td class="content" id="description_143">接收解扰数据流的流程与上述双线程模式中接收解扰数据流的流程相
    同。
    
				</td></tr><tr><td class="content" id="description_144">从智能卡接口接收到的其他命令可能是创建文件、访问文件安全认证
    等，都是智能卡的标准命令，属于本领域普通技术人员的惯用技术手段且不
    是本发明的重点，这里不再赘述。
    
				</td></tr><tr><td class="content" id="description_145">本发明中的高速数据接口还可以采用MMC、USB或非接触式接口等高
    速数据接口，具体操作过程与上述实施例基本相同，这里不再赘述。
    
				</td></tr><tr><td class="content" id="description_146">以上所述仅为本发明的较佳实施例而已，并不用以限制本发明，凡在本
    发明的精神和原则之内，所做的任何修改、等同替换、改进等，均应包含在
    本发明的保护范围之内。
    
				</td></tr></table></div></body></html>